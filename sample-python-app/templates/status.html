{% extends "base.html" %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="text-center mb-5">
                    <i class="fas fa-chart-line text-success"></i> System Status
                </h1>
                
                <!-- Status Overview Cards -->
                <div class="row g-4 mb-5">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="text-primary" style="font-size: 2rem;">
                                    <i class="fas fa-microchip"></i>
                                </div>
                                <h5 class="card-title">CPU Usage</h5>
                                <h3 class="text-primary">{{ "%.1f"|format(status.cpu_usage) }}%</h3>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" role="progressbar" 
                                         data-width="{{ "%.1f"|format(status.cpu_usage) }}"
                                         aria-valuenow="{{ "%.1f"|format(status.cpu_usage) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="text-info" style="font-size: 2rem;">
                                    <i class="fas fa-memory"></i>
                                </div>
                                <h5 class="card-title">Memory Usage</h5>
                                <h3 class="text-info">{{ "%.1f"|format(status.memory_usage) }}%</h3>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-info" role="progressbar" 
                                         data-width="{{ "%.1f"|format(status.memory_usage) }}"
                                         aria-valuenow="{{ "%.1f"|format(status.memory_usage) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="text-warning" style="font-size: 2rem;">
                                    <i class="fas fa-hdd"></i>
                                </div>
                                <h5 class="card-title">Disk Usage</h5>
                                <h3 class="text-warning">{{ "%.1f"|format(status.disk_usage) }}%</h3>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-warning" role="progressbar" 
                                         data-width="{{ "%.1f"|format(status.disk_usage) }}"
                                         aria-valuenow="{{ "%.1f"|format(status.disk_usage) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <div class="text-success" style="font-size: 2rem;">
                                    <i class="fas fa-heartbeat"></i>
                                </div>
                                <h5 class="card-title">Status</h5>
                                <h3 class="text-success">Healthy</h3>
                                <small class="text-muted">All systems operational</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Information -->
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-server"></i> System Resources
                                </h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Total Memory:</strong></td>
                                        <td>{{ status.memory_total }} GB</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Available Memory:</strong></td>
                                        <td>{{ status.memory_available }} GB</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total Disk:</strong></td>
                                        <td>{{ status.disk_total }} GB</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Free Disk:</strong></td>
                                        <td>{{ status.disk_free }} GB</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-clock"></i> System Information
                                </h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Last Updated:</strong></td>
                                        <td>{{ status.uptime.split('T')[1].split('.')[0] }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Date:</strong></td>
                                        <td>{{ status.uptime.split('T')[0] }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>CPU Usage:</strong></td>
                                        <td>{{ "%.1f"|format(status.cpu_usage) }}%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Memory Usage:</strong></td>
                                        <td>{{ "%.1f"|format(status.memory_usage) }}%</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-tools"></i> Quick Actions
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-success w-100" onclick="checkHealth()">
                                            <i class="fas fa-heartbeat"></i> Health Check
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-info w-100" onclick="getSystemInfo()">
                                            <i class="fas fa-info-circle"></i> System Info
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-primary w-100" onclick="refreshPage()">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <a href="{{ url_for('home') }}" class="btn btn-outline-secondary w-100">
                                            <i class="fas fa-home"></i> Home
                                        </a>
                                    </div>
                                </div>
                                <div id="actionResult" class="mt-3" style="display: none;">
                                    <h6>Result:</h6>
                                    <pre class="bg-dark text-light p-3 rounded" id="actionResponse"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
function showResult(data) {
    const resultDiv = document.getElementById('actionResult');
    const responseDiv = document.getElementById('actionResponse');
    responseDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.style.display = 'block';
}

function checkHealth() {
    fetch('/health')
        .then(response => response.json())
        .then(data => showResult(data))
        .catch(error => showResult({error: error.message}));
}

function getSystemInfo() {
    fetch('/api/info')
        .then(response => response.json())
        .then(data => showResult(data))
        .catch(error => showResult({error: error.message}));
}

function refreshPage() {
    location.reload();
}

// Apply progress bar widths from data attributes
document.addEventListener('DOMContentLoaded', function() {
    const progressBars = document.querySelectorAll('.progress-bar[data-width]');
    progressBars.forEach(function(bar) {
        const width = bar.getAttribute('data-width');
        bar.style.width = width + '%';
    });
});

// Auto-refresh status every 30 seconds
setInterval(function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (!urlParams.has('autorefresh') || urlParams.get('autorefresh') === 'true') {
        location.reload();
    }
}, 30000);
</script>
{% endblock %}